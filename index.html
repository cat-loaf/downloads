<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%23FFD700' d='M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z'/></svg>" type="image/svg+xml">
</head>
<body class="dark-theme">
    <div id="file-explorer">
        <div id="explorer-header">
            <input type="text" id="search" placeholder="Search files..." />
            <button id="theme-toggle" title="Toggle theme">
                <i class="fas fa-sun"></i>
            </button>
        </div>
        <ul id="file-list"></ul>
    </div>
    <script>
    // GitHub repository information - update these for your repo
    const GITHUB_USERNAME = 'your-username'; // Replace with your GitHub username
    const GITHUB_REPO = 'your-repo-name';    // Replace with your repository name
    const FS_FOLDER = 'fs';                  // The folder to explore

    // Static fallback file system (used if GitHub API fails)
    const fallbackFileSystem = [
        { path: 'fs/hi.txt', type: 'file' },
        { path: 'fs/hello.txt', type: 'file' },
        { path: 'fs/macros', type: 'folder' },
        { path: 'fs/macros/grow_a_garden_stay_alive.rec', type: 'file' },
        // Add more files here as needed
    ];

    let fileSystem = [];

    // Fetch file system from GitHub API
    async function fetchFileSystemFromGitHub() {
        try {
            const response = await fetch(`https://api.github.com/repos/cat-loaf/downloads/git/trees/main?recursive=1`);
            
            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status}`);
            }
            
            const data = await response.json();
            
            // Filter files that are in the fs folder
            const fsFiles = data.tree
                .filter(item => item.path.startsWith(FS_FOLDER + '/'))
                .map(item => ({
                    path: item.path,
                    type: item.type === 'tree' ? 'folder' : 'file'
                }));
            
            // Add the fs folder itself if it exists
            if (fsFiles.length > 0) {
                fsFiles.unshift({ path: FS_FOLDER, type: 'folder' });
            }
            
            return fsFiles;
        } catch (error) {
            console.warn('Failed to fetch from GitHub API, using fallback:', error);
            return fallbackFileSystem;
        }
    }

    // Initialize file system
    async function initializeFileSystem() {
        fileSystem = await fetchFileSystemFromGitHub();
        updateExplorer();
    }

    // Helper to build tree structure
    function buildTree(files, query = '') {
        const tree = {};
        
        // Filter files based on search query
        const filteredFiles = query ? 
            files.filter(item => item.path.toLowerCase().includes(query.toLowerCase())) : 
            files;
            
        filteredFiles.forEach(item => {
            // Remove "fs/" prefix to treat it as root
            const cleanPath = item.path.startsWith('fs/') ? item.path.substring(3) : item.path;
            if (!cleanPath) return; // Skip if path becomes empty
            
            const parts = cleanPath.split('/');
            let current = tree;
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                if (!current[part]) {
                    current[part] = { 
                        _type: (i === parts.length - 1 ? item.type : 'folder'), 
                        _children: {},
                        _path: item.path, // Keep original path for linking
                        _displayName: part
                    };
                }
                current = current[part]._children;
            }
        });
        return tree;
    }

    // Get file icon based on extension
    function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        const iconMap = {
            'txt': 'fas fa-file-alt',
            'md': 'fab fa-markdown',
            'js': 'fab fa-js-square',
            'html': 'fab fa-html5',
            'css': 'fab fa-css3-alt',
            'json': 'fas fa-file-code',
            'png': 'fas fa-file-image',
            'jpg': 'fas fa-file-image',
            'jpeg': 'fas fa-file-image',
            'gif': 'fas fa-file-image',
            'svg': 'fas fa-file-image',
            'pdf': 'fas fa-file-pdf',
            'zip': 'fas fa-file-archive',
            'rar': 'fas fa-file-archive',
            'py': 'fab fa-python',
            'java': 'fab fa-java',
            'cpp': 'fas fa-file-code',
            'c': 'fas fa-file-code',
            'php': 'fab fa-php',
            'xml': 'fas fa-file-code',
            'yml': 'fas fa-file-code',
            'yaml': 'fas fa-file-code',
            'default': 'fas fa-file'
        };
        return iconMap[ext] || iconMap['default'];
    }

    // Render tree as HTML with clickable links
    function renderTree(tree, parentPath = '', level = 0) {
        let html = '<ul>';
        for (const key in tree) {
            const node = tree[key];
            // Calculate indentation based on depth
            const indentPixels = level * 20; // 20px per level
            
            if (node._type === 'folder') {
                const folderId = `folder-${parentPath}-${key}`.replace(/[^a-zA-Z0-9-]/g, '-');
                html += `<li class="folder-item" data-level="${level}">
                    <div class="folder-header" onclick="toggleFolder('${folderId}')" style="padding-left: ${16 + indentPixels}px;">
                        <i class="fas fa-chevron-right folder-chevron" id="chevron-${folderId}"></i>
                        <i class="fas fa-folder folder-icon"></i>
                        <strong class="folder-name">${key}</strong>
                    </div>
                    <div class="folder-contents" id="${folderId}" style="display: none;">
                        ${renderTree(node._children, parentPath + '/' + key, level + 1)}
                    </div>
                </li>`;
            } else {
                const iconClass = getFileIcon(key);
                // Files need extra padding to align with folder content (chevron width + margin)
                const fileIndentPixels = indentPixels + 18; // 18px = chevron (12px) + margin (6px)
                html += `<li class="file-item" data-level="${level}">
                    <div class="file-content" style="padding-left: ${16 + fileIndentPixels}px;">
                        <i class="${iconClass} file-icon"></i>
                        <a href="${node._path}" target="_blank" class="file-link">${key}</a>
                    </div>
                </li>`;
            }
        }
        html += '</ul>';
        return html;
    }

    // Toggle folder open/close
    function toggleFolder(folderId) {
        const folder = document.getElementById(folderId);
        const chevron = document.getElementById(`chevron-${folderId}`);
        
        if (folder.style.display === 'none') {
            folder.style.display = 'block';
            chevron.classList.remove('fa-chevron-right');
            chevron.classList.add('fa-chevron-down');
        } else {
            folder.style.display = 'none';
            chevron.classList.remove('fa-chevron-down');
            chevron.classList.add('fa-chevron-right');
        }
    }

    // Update explorer with search functionality
    function updateExplorer(query = '') {
        const tree = buildTree(fileSystem, query);
        document.getElementById('file-list').innerHTML = renderTree(tree);
    }

    document.getElementById('search').addEventListener('input', function() {
        updateExplorer(this.value);
    });

    // Theme toggle functionality
    const themeToggle = document.getElementById('theme-toggle');
    const body = document.body;
    const themeIcon = themeToggle.querySelector('i');

    themeToggle.addEventListener('click', function() {
        body.classList.toggle('dark-theme');
        body.classList.toggle('light-theme');
        
        if (body.classList.contains('dark-theme')) {
            themeIcon.className = 'fas fa-sun';
            localStorage.setItem('theme', 'dark');
        } else {
            themeIcon.className = 'fas fa-moon';
            localStorage.setItem('theme', 'light');
        }
    });

    // Load saved theme or default to dark
    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') {
        body.classList.remove('dark-theme');
        body.classList.add('light-theme');
        themeIcon.className = 'fas fa-moon';
    }

    // Make toggleFolder available globally
    window.toggleFolder = toggleFolder;

    // Initialize the file system and render
    initializeFileSystem();
    </script>
    <style>
    /* Dark theme (default) */
    body.dark-theme {
        background-color: #0d1117;
        color: #c9d1d9;
    }

    /* Light theme */
    body.light-theme {
        background-color: #ffffff;
        color: #24292e;
    }

    #file-explorer {
        width: 350px;
        margin: 40px auto;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        overflow: hidden;
        transition: all 0.3s ease;
    }

    /* Dark theme styles */
    body.dark-theme #file-explorer {
        border: 1px solid #30363d;
        background: #161b22;
    }

    /* Light theme styles */
    body.light-theme #file-explorer {
        border: 1px solid #e1e4e8;
        background: #ffffff;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    #explorer-header {
        display: flex;
        align-items: center;
        border-bottom: 1px solid;
        transition: border-color 0.3s ease;
    }

    body.dark-theme #explorer-header {
        border-bottom-color: #30363d;
    }

    body.light-theme #explorer-header {
        border-bottom-color: #e1e4e8;
    }
    
    #search {
        flex: 1;
        padding: 12px 16px;
        border: none;
        font-size: 14px;
        box-sizing: border-box;
        outline: none;
        transition: background-color 0.3s ease;
    }

    body.dark-theme #search {
        background: #21262d;
        color: #c9d1d9;
    }

    body.light-theme #search {
        background: #f8f9fa;
        color: #24292e;
    }
    
    body.dark-theme #search:focus {
        background: #161b22;
    }

    body.light-theme #search:focus {
        background: #ffffff;
    }

    #theme-toggle {
        padding: 12px 16px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        outline: none;
    }

    body.dark-theme #theme-toggle {
        background: #21262d;
        color: #f0d000;
    }

    body.light-theme #theme-toggle {
        background: #f8f9fa;
        color: #586069;
    }

    #theme-toggle:hover {
        opacity: 0.8;
    }
    
    #file-list {
        padding: 8px 0;
        max-height: 400px;
        overflow-y: auto;
    }
    
    ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    ul ul {
        padding-left: 0;
        margin: 0;
    }
    
    li {
        margin: 0;
        position: relative;
    }
    
    .folder-item {
        margin-bottom: 0;
    }
    
    .folder-header {
        display: flex;
        align-items: center;
        padding: 4px 16px 4px 16px; /* Will be overridden by inline style */
        cursor: pointer;
        transition: background-color 0.15s ease;
        user-select: none;
    }
    
    .folder-contents {
        margin-left: 0;
    }
    
    .file-item {
        margin-bottom: 0;
    }
    
    .file-content {
        display: flex;
        align-items: center;
        padding: 4px 16px 4px 16px; /* Will be overridden by inline style */
        transition: background-color 0.15s ease;
    }
    
    .folder-chevron {
        font-size: 12px;
        margin-right: 6px;
        width: 12px;
        color: #8b949e;
        transition: transform 0.2s ease;
    }
    
    body.dark-theme .folder-header:hover {
        background-color: #21262d;
    }

    body.light-theme .folder-header:hover {
        background-color: #f1f8ff;
    }
    
    body.dark-theme .file-content:hover {
        background-color: #21262d;
    }

    body.light-theme .file-content:hover {
        background-color: #f1f8ff;
    }
    
    .file-icon, .folder-icon {
        font-size: 14px;
        margin-right: 8px;
        width: 16px;
        text-align: center;
        transition: color 0.3s ease;
    }

    body.dark-theme .file-icon, 
    body.dark-theme .folder-icon {
        color: #8b949e;
    }

    body.light-theme .file-icon, 
    body.light-theme .folder-icon {
        color: #586069;
    }
    
    .folder-icon {
        color: #79b8ff !important;
    }
    
    .file-icon.fab.fa-html5 {
        color: #e34c26;
    }
    
    .file-icon.fab.fa-css3-alt {
        color: #1572b6;
    }
    
    .file-icon.fab.fa-js-square {
        color: #f7df1e;
    }
    
    .file-icon.fab.fa-python {
        color: #3776ab;
    }
    
    .file-icon.fab.fa-java {
        color: #007396;
    }
    
    .file-icon.fab.fa-markdown {
        color: #083fa1;
    }
    
    .file-icon.fas.fa-file-pdf {
        color: #ff0000;
    }
    
    .file-icon.fas.fa-file-image {
        color: #ff6b6b;
    }
    
    .file-link {
        text-decoration: none;
        font-size: 14px;
        flex: 1;
        padding: 2px 0;
        transition: color 0.3s ease;
    }

    body.dark-theme .file-link {
        color: #c9d1d9;
    }

    body.light-theme .file-link {
        color: #24292e;
    }
    
    body.dark-theme .file-link:hover {
        color: #58a6ff;
    }

    body.light-theme .file-link:hover {
        color: #0366d6;
    }
    
    .folder-name {
        font-weight: 500;
        font-size: 14px;
        flex: 1;
        padding: 2px 0;
        transition: color 0.3s ease;
    }

    body.dark-theme .folder-name {
        color: #c9d1d9;
    }

    body.light-theme .folder-name {
        color: #24292e;
    }
    
    /* Custom scrollbar for webkit browsers */
    #file-list::-webkit-scrollbar {
        width: 6px;
    }
    
    body.dark-theme #file-list::-webkit-scrollbar-track {
        background: #161b22;
    }

    body.light-theme #file-list::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    
    body.dark-theme #file-list::-webkit-scrollbar-thumb {
        background: #30363d;
        border-radius: 3px;
    }

    body.light-theme #file-list::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 3px;
    }
    
    body.dark-theme #file-list::-webkit-scrollbar-thumb:hover {
        background: #484f58;
    }

    body.light-theme #file-list::-webkit-scrollbar-thumb:hover {
        background: #a8a8a8;
    }
    </style>
</body>
</html>